<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>KOREA SCANNER V8: FLAG EDITION</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    :root {
      --kr-red: #CD2E3A;
      --kr-blue: #0047A0;
      --laser-cyan: #00f2ff;
    }

    html, body { height: 100%; margin: 0; font-family: 'Malgun Gothic', 'Microsoft JhengHei', sans-serif; background: #fff; overflow: hidden; }
    #map { height: 100vh; width: 100vw; z-index: 1; }

    .header-ui { 
        position: absolute; top: 0; left: 0; width: 100%; height: 320px; 
        background: linear-gradient(to bottom, rgba(255,255,255,0.95) 0%, transparent 100%); 
        z-index: 1001; pointer-events: none;
    }

    .viewport { position: relative; width: 100%; height: 280px; }
    .belt { 
        display: flex; position: absolute; left: 50%; top: 40px;
        transition: transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    
    .city-card { 
        width: 240px; padding: 20px; margin-right: 40px;
        background: #fff; border: 5px solid #000; border-radius: 20px;
        opacity: 0.2; transform: scale(0.8); transition: 0.5s;
        display: flex; flex-direction: column; align-items: center;
        flex-shrink: 0; box-shadow: 12px 12px 0px #000;
        position: relative; overflow: hidden;
    }

    /* ÂúãÊóóË£ùÈ£æÂÖÉÁ¥† */
    .city-card::before {
        content: "üá∞üá∑"; position: absolute; top: -10px; right: -10px;
        font-size: 5rem; opacity: 0.1; transform: rotate(15deg);
    }

    .city-card.active { 
        opacity: 1; transform: scale(1.1) rotate(-1deg); 
        border-image: linear-gradient(45deg, var(--kr-red), var(--kr-blue)) 1;
        border: 6px solid;
        box-shadow: 0 0 30px rgba(0,0,0,0.2), 15px 15px 0px #000;
    }

    .city-name-ko { font-size: 2.4rem; font-weight: 900; color: #000; z-index: 2; }
    .city-name-cn { font-size: 1.6rem; color: #333; font-weight: bold; z-index: 2; }
    .city-name-en { font-size: 0.9rem; color: var(--kr-blue); font-weight: 900; letter-spacing: 1px; }

    .stats-panel { 
        position: absolute; bottom: 25px; left: 25px; z-index: 1002; 
        background: #fff; padding: 12px 30px; border: 5px solid #000;
        display: flex; gap: 30px; border-radius: 15px; box-shadow: 8px 8px 0px #000;
    }

    .control-layer { position: absolute; bottom: 40px; left: 50%; transform: translateX(-50%); z-index: 1005; }
    .btn { 
        padding: 15px 50px; font-size: 1.3rem; font-weight: 900; cursor: pointer; 
        border-radius: 20px; border: 4px solid #000; color: #fff; display: none; 
        box-shadow: 6px 6px 0px #000;
    }
    #confirmBtn { background: var(--kr-red); }
    #nextBtn { background: var(--kr-blue); }
    .btn:active { transform: translate(3px, 3px); box-shadow: 2px 2px 0px #000; }

    .modal-overlay { position: fixed; inset: 0; display: flex; align-items: center; justify-content: center; z-index: 2000; background: #fff; }
    .start-box { 
        text-align: center; border: 6px solid #000; padding: 50px; background: #fff; 
        width: 400px; border-radius: 30px; box-shadow: 25px 25px 0px var(--kr-blue);
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <div class="header-ui">
    <div class="viewport"><div class="belt" id="belt"></div></div>
  </div>
  
  <div class="stats-panel" id="statsPanel" style="display:none">
    <div id="score" style="font-size:1.5rem; font-weight:900;">SCORE: 0</div>
    <div style="font-size:1.5rem; font-weight:900;"><span id="progress">0</span> / <span id="total">0</span></div>
  </div>

  <div class="control-layer">
    <button class="btn" id="confirmBtn">CONFIRM (SPACE)</button>
    <button class="btn" id="nextBtn">NEXT (SPACE) ‚ùØ</button>
  </div>

  <div id="startModal" class="modal-overlay">
    <div class="start-box">
      <h1 style="font-size: 3rem; font-weight: 900; margin:0;">üá∞üá∑ KOREA<br>SCANNER</h1>
      <div id="countDisplay" style="font-size: 6rem; font-weight: 900; margin: 20px 0;">100</div>
      <input type="range" id="citySlider" min="5" max="100" value="100" style="width:100%; accent-color:#000;">
      <button id="startBtn" style="width:100%; padding:20px; background:#000; color:#fff; font-weight:900; border:none; border-radius:15px; margin-top:30px; cursor:pointer; font-size:1.5rem;">START MISSION</button>
    </div>
  </div>

  <script>
    // 100 ÂüéÂ∏ÇË≥áÊñôÂ∫´Â∑≤Â∞±Á∑í
    const DB = [
        {ko:"ÏÑúÏö∏",en:"Seoul",cn:"È¶ñÁàæ",coords:[37.5665,126.9780]},{ko:"Î∂ÄÏÇ∞",en:"Busan",cn:"ÈáúÂ±±",coords:[35.1796,129.0756]},{ko:"Ïù∏Ï≤ú",en:"Incheon",cn:"‰ªÅÂ∑ù",coords:[37.4563,126.7052]},{ko:"ÎåÄÍµ¨",en:"Daegu",cn:"Â§ßÈÇ±",coords:[35.8714,128.6014]},{ko:"ÎåÄÏ†Ñ",en:"Daejeon",cn:"Â§ßÁî∞",coords:[36.3504,127.3845]},{ko:"Í¥ëÏ£º",en:"Gwangju",cn:"ÂÖâÂ∑û",coords:[35.1595,126.8526]},{ko:"Ïö∏ÏÇ∞",en:"Ulsan",cn:"ËîöÂ±±",coords:[35.5384,129.3114]},{ko:"ÏÑ∏Ï¢Ö",en:"Sejong",cn:"‰∏ñÂÆó",coords:[36.4800,127.2890]},{ko:"ÏàòÏõê",en:"Suwon",cn:"Ê∞¥Âéü",coords:[37.2636,127.0286]},{ko:"Í≥†ÈôΩ",en:"Goyang",cn:"È´òÈôΩ",coords:[37.6584,126.8320]},{ko:"Ïö©Ïù∏",en:"Yongin",cn:"Èæç‰ªÅ",coords:[37.2410,127.1779]},{ko:"ÏÑ±ÎÇ®",en:"Seongnam",cn:"ÂüéÂçó",coords:[37.4200,127.1265]},{ko:"Ï∞ΩÏõê",en:"Changwon",cn:"ÊòåÂéü",coords:[35.2280,128.6811]},{ko:"Ï≤≠Ï£º",en:"Cheongju",cn:"Ê∏ÖÂ∑û",coords:[36.6424,127.4890]},{ko:"Ï†ÑÏ£º",en:"Jeonju",cn:"ÂÖ®Â∑û",coords:[35.8242,127.1480]},{ko:"Ï≤úÏïà",en:"Cheonan",cn:"Â§©ÂÆâ",coords:[36.8151,127.1139]},{ko:"ÏïàÏÇ∞",en:"Ansan",cn:"ÂÆâÂ±±",coords:[37.3219,126.8308]},{ko:"ÎÇ®ÏñëÏ£º",en:"Namyangju",cn:"ÂçóÊ•äÂ∑û",coords:[37.6360,127.2165]},{ko:"ÌôîÏÑ±",en:"Hwaseong",cn:"ËèØÂüé",coords:[37.1995,126.8312]},{ko:"ÏïàÏñë",en:"Anyang",cn:"ÂÆâÈ§ä",coords:[37.3943,126.9568]},{ko:"ÍπÄÌï¥",en:"Gimhae",cn:"ÈáëÊµ∑",coords:[35.2358,128.8817]},{ko:"Ìè¨Ìï≠",en:"Pohang",cn:"Êµ¶È†Ö",coords:[36.0190,129.3435]},{ko:"ÌèâÌÉù",en:"Pyeongtaek",cn:"Âπ≥Êæ§",coords:[36.9921,127.1128]},{ko:"Ï†úÏ£º",en:"Jeju",cn:"ÊøüÂ∑û",coords:[33.4996,126.5312]},{ko:"ÏùòÏ†ïÎ∂Ä",en:"Uijeongbu",cn:"Ë≠∞ÊîøÂ∫ú",coords:[37.7381,127.0337]},{ko:"ÌååÏ£º",en:"Paju",cn:"Âù°Â∑û",coords:[37.7600,126.7800]},{ko:"ÏãúÌù•",en:"Siheung",cn:"ÂßãËàà",coords:[37.3800,126.8034]},{ko:"ÍπÄÌè¨",en:"Gimpo",cn:"ÈáëÊµ¶",coords:[37.6151,126.7153]},{ko:"ÏßÑÏ£º",en:"Jinju",cn:"ÊôâÂ∑û",coords:[35.1798,128.1076]},{ko:"Í¥ëÎ™Ö",en:"Gwangmyeong",cn:"ÂÖâÊòé",coords:[37.4785,126.8646]},{ko:"ÏõêÏ£º",en:"Wonju",cn:"ÂéüÂ∑û",coords:[37.3422,127.9202]},{ko:"ÏïÑÏÇ∞",en:"Asan",cn:"ÁâôÂ±±",coords:[36.7898,127.0017]},{ko:"ÏùµÏÇ∞",en:"Iksan",cn:"ÁõäÂ±±",coords:[35.9483,126.9576]},{ko:"ÏñëÏÇ∞",en:"Yangsan",cn:"Ê¢ÅÂ±±",coords:[35.3385,129.0371]},{ko:"Íµ∞Ìè¨",en:"Gunpo",cn:"ËªçÊµ¶",coords:[37.3617,126.9353]},{ko:"Íµ∞ÏÇ∞",en:"Gunsan",cn:"Áæ§Â±±",coords:[35.9676,126.7366]},{ko:"Í≤ΩÏ£º",en:"Gyeongju",cn:"ÊÖ∂Â∑û",coords:[35.8562,129.2247]},{ko:"Í≤ΩÏÇ∞",en:"Gyeongsan",cn:"ÊÖ∂Â±±",coords:[35.8250,128.7413]},{ko:"Ïó¨Ïàò",en:"Yeosu",cn:"È∫óÊ∞¥",coords:[34.7604,127.6622]},{ko:"ÏàúÏ≤ú",en:"Suncheon",cn:"È†ÜÂ§©",coords:[34.9506,127.4872]},{ko:"Í±∞Ï†ú",en:"Geoje",cn:"Â∑®Êøü",coords:[34.8806,128.6211]},{ko:"Î™©Ìè¨",en:"Mokpo",cn:"Êú®Êµ¶",coords:[34.8118,126.3922]},{ko:"Í∞ïÎ¶â",en:"Gangneung",cn:"Ê±üÈôµ",coords:[37.7519,128.8761]},{ko:"Ïò§ÏÇ∞",en:"Osan",cn:"ÁÉèÂ±±",coords:[37.1498,127.0776]},{ko:"Ï∂©Ï£º",en:"Chungju",cn:"Âø†Â∑û",coords:[36.9910,127.9259]},{ko:"Ïù¥Ï≤ú",en:"Icheon",cn:"Âà©Â∑ù",coords:[37.2723,127.4351]},{ko:"ÏñëÏ£º",en:"Yangju",cn:"Ê•äÂ∑û",coords:[37.7853,127.0457]},{ko:"ÏïàÏÑ±",en:"Anseong",cn:"ÂÆâÂüé",coords:[37.0080,127.2798]},{ko:"Íµ¨Î¶¨",en:"Guri",cn:"‰πùÈáå",coords:[37.5943,127.1296]},{ko:"ÏÑúÏÇ∞",en:"Seosan",cn:"ÁëûÂ±±",coords:[36.7845,126.4504]},{ko:"ÎãπÏßÑ",en:"Dangjin",cn:"ÂîêÊ¥•",coords:[36.8898,126.6274]},{ko:"ÏïàÎèô",en:"Andong",cn:"ÂÆâÊù±",coords:[36.5684,128.7294]},{ko:"Ìè¨Ï≤ú",en:"Pocheon",cn:"Êä±Â∑ù",coords:[37.8949,127.2003]},{ko:"ÏùòÏôï",en:"Uiwang",cn:"ÂÑÄÁéã",coords:[37.3448,126.9683]},{ko:"ÌïòÎÇ®",en:"Hanam",cn:"Ê≤≥Âçó",coords:[37.5392,127.2148]},{ko:"Í¥ëÏñë",en:"Gwangyang",cn:"ÂÖâÈôΩ",coords:[34.9407,127.6908]},{ko:"ÍπÄÏ≤ú",en:"Gimcheon",cn:"ÈáëÊ≥â",coords:[36.1394,128.1136]},{ko:"ÌÜµÏòÅ",en:"Tongyeong",cn:"Áµ±Ááü",coords:[34.8544,128.4331]},{ko:"Ï†úÏ≤ú",en:"Jecheon",cn:"Â†§Â∑ù",coords:[37.1326,128.2141]},{ko:"ÎÖºÏÇ∞",en:"Nonsan",cn:"Ë´ñÂ±±",coords:[36.1871,127.0984]},{ko:"Í≥µÏ£º",en:"Gongju",cn:"ÂÖ¨Â∑û",coords:[36.4465,127.1190]},{ko:"ÏÇ¨Ï≤ú",en:"Sacheon",cn:"Ê≥óÂ∑ù",coords:[35.0039,128.0642]},{ko:"Ï†ïÏùç",en:"Jeongeup",cn:"‰∫ïÈÇë",coords:[35.5699,126.8573]},{ko:"ÏòÅÏ£º",en:"Yeongju",cn:"Ê¶ÆÂ∑û",coords:[36.8056,128.6240]},{ko:"Î∞ÄÏñë",en:"Miryang",cn:"ÂØÜÈôΩ",coords:[35.5038,128.7466]},{ko:"ÏÉÅÏ£º",en:"Sangju",cn:"Â∞öÂ∑û",coords:[36.4109,128.1591]},{ko:"Î≥¥Î†π",en:"Boryeong",cn:"‰øùÂØß",coords:[36.3333,126.6122]},{ko:"ÏòÅÏ≤ú",en:"Yeongcheon",cn:"Ê∞∏Â∑ù",coords:[35.9733,128.9388]},{ko:"ÎèôÎëêÏ≤ú",en:"Dongducheon",cn:"Êù±Ë±ÜÂ∑ù",coords:[37.9036,127.0607]},{ko:"ÎèôÌï¥",en:"Donghae",cn:"Êù±Êµ∑",coords:[37.5244,129.1143]},{ko:"ÍπÄÏ†ú",en:"Gimje",cn:"ÈáëÂ†§",coords:[35.8032,126.8808]},{ko:"ÏÜçÏ¥à",en:"Sokcho",cn:"ÊùüËçâ",coords:[38.2070,128.5918]},{ko:"ÎÇ®Ïõê",en:"Namwon",cn:"ÂçóÂéü",coords:[35.4164,127.3904]},{ko:"ÎÇòÏ£º",en:"Naju",cn:"ÁæÖÂ∑û",coords:[35.0158,126.7108]},{ko:"Î¨∏Í≤Ω",en:"Mungyeong",cn:"ËÅûÊÖ∂",coords:[36.5861,128.1868]},{ko:"ÏÇºÏ≤ô",en:"Samcheok",cn:"‰∏âÈôü",coords:[37.4498,129.1648]},{ko:"Í≥ºÏ≤ú",en:"Gwacheon",cn:"ÊûúÂ∑ù",coords:[37.4292,126.9899]},{ko:"ÌÉúÎ∞±",en:"Taebaek",cn:"Â§™ÁôΩ",coords:[37.1641,128.9856]},{ko:"Í≥ÑÎ£°",en:"Gyeryong",cn:"ÈõûÈæç",coords:[36.2746,127.2486]},{ko:"ÏÑúÍ∑ÄÌè¨",en:"Seogwipo",cn:"Ë•øÊ≠∏Êµ¶",coords:[33.2541,126.5601]},{ko:"ÏñëÌèâ",en:"Yangpyeong",cn:"Ê•äÂπ≥",coords:[37.4917,127.4875]},{ko:"ÌôçÏÑ±",en:"Hongseong",cn:"Ê¥™Âüé",coords:[36.6013,126.6608]},{ko:"ÏòàÏÇ∞",en:"Yesan",cn:"Á¶ÆÂ±±",coords:[36.6811,126.8465]},{ko:"Î∂ÄÏó¨",en:"Buyeo",cn:"Êâ∂È§ò",coords:[36.2747,126.9125]},{ko:"ÌÉúÏïà",en:"Taean",cn:"Ê≥∞ÂÆâ",coords:[36.7544,126.2981]},{ko:"ÏùåÏÑ±",en:"Eumseong",cn:"Èô∞Âüé",coords:[36.9402,127.6905]},{ko:"ÏßÑÏ≤ú",en:"Jincheon",cn:"ÈéÆÂ∑ù",coords:[36.8553,127.4387]},{ko:"Í∞ÄÌèâ",en:"Gapyeong",cn:"Âä†Âπ≥",coords:[37.8315,127.5095]},{ko:"Ïó∞Ï≤ú",en:"Yeoncheon",cn:"Êº£Â∑ù",coords:[38.0964,127.0754]},{ko:"ÌôçÏ≤ú",en:"Hongcheon",cn:"Ê¥™Â∑ù",coords:[37.6975,127.8887]},{ko:"Ìö°ÏÑ±",en:"Hoengseong",cn:"Ê©´Âüé",coords:[37.4918,127.9850]},{ko:"ÌèâÏ∞Ω",en:"Pyeongchang",cn:"Âπ≥Êòå",coords:[37.3705,128.3903]},{ko:"Ï†ïÏÑ†",en:"Jeongseon",cn:"ÊóåÂñÑ",coords:[37.3807,128.6608]},{ko:"Ï≤†Ïõê",en:"Cheorwon",cn:"ÈêµÂéü",coords:[38.1465,127.3134]},{ko:"ÌôîÏ≤ú",en:"Hwacheon",cn:"ËèØÂ∑ù",coords:[38.1057,127.7082]},{ko:"Ïù∏Ï†ú",en:"Inje",cn:"È∫üËπÑ",coords:[38.0697,128.1703]},{ko:"Í≥†ÏÑ±",en:"Goseong",cn:"È´òÂüé",coords:[38.3805,128.4687]},{ko:"Ïö∏ÏßÑ",en:"Uljin",cn:"ËîöÁèç",coords:[36.9930,129.4005]},{ko:"ÏòÅÎçï",en:"Yeongdeok",cn:"ÁõàÂæ∑",coords:[36.4150,129.3658]},{ko:"Ïπ†Í≥°",en:"Chilgok",cn:"ÊºÜË∞∑",coords:[35.9958,128.4017]}
    ];

    let cities=[], idx=0, score=0, currentClick=null, isAnswered=false;
    let pMarker=null, tMarker=null, line=null;

    const map = L.map('map',{zoomControl:false, attributionControl:false}).setView([36.2, 127.8], 7);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png').addTo(map);

    document.getElementById('citySlider').oninput = function() {
        document.getElementById('countDisplay').innerText = this.value;
    };

    function startMission() {
        const num = parseInt(document.getElementById('citySlider').value);
        cities = [...DB].sort(() => Math.random() - 0.5).slice(0, num);
        document.getElementById('startModal').style.display = 'none';
        document.getElementById('statsPanel').style.display = 'flex';
        document.getElementById('total').innerText = cities.length;

        const belt = document.getElementById('belt');
        belt.innerHTML = cities.map(c => `
            <div class="city-card">
                <div class="city-name-ko">${c.ko}</div>
                <div class="city-name-cn">${c.cn}</div>
                <div class="city-name-en">${c.en.toUpperCase()}</div>
            </div>
        `).join('');
        setTimeout(refreshRound, 100);
    }

    function refreshRound() {
        isAnswered = false; currentClick = null;
        if(pMarker) map.removeLayer(pMarker);
        if(tMarker) map.removeLayer(tMarker);
        if(line) map.removeLayer(line);

        document.getElementById('confirmBtn').style.display = 'none';
        document.getElementById('nextBtn').style.display = 'none';
        document.getElementById('progress').innerText = idx + 1;
        
        const cards = document.querySelectorAll('.city-card');
        cards.forEach(c => c.classList.remove('active'));
        const activeCard = cards[idx];
        activeCard.classList.add('active');

        const moveX = -(activeCard.offsetLeft + (activeCard.offsetWidth / 2));
        document.getElementById('belt').style.transform = `translateX(${moveX}px)`;
        map.flyTo([36.2, 127.8], 7, {animate: true, duration: 1});
    }

    map.on('click', e => {
        if(isAnswered) return;
        currentClick = e.latlng;
        if(pMarker) map.removeLayer(pMarker);
        pMarker = L.circleMarker(e.latlng, {radius:12, color:'#000', fillColor:'#fff', weight:4, fillOpacity:1}).addTo(map);
        document.getElementById('confirmBtn').style.display = 'block';
    });

    function handleConfirm() {
        if(!currentClick || isAnswered) return;
        isAnswered = true;
        document.getElementById('confirmBtn').style.display = 'none';

        const target = cities[idx];
        const dist = map.distance(currentClick, target.coords) / 1000;
        const pts = Math.round(5000 * Math.pow(Math.E, -dist / 100));

        tMarker = L.circleMarker(target.coords, {radius:15, color:'#000', fillColor:'#CD2E3A', weight:4, fillOpacity:1}).addTo(map);
        line = L.polyline([currentClick, target.coords], {color: '#0047A0', weight:5, dashArray:'10,10'}).addTo(map);
        
        score += pts;
        document.getElementById('score').innerText = `SCORE: ${score.toLocaleString()}`;
        map.flyTo(target.coords, 10, {animate: true, duration: 0.8});
        setTimeout(() => document.getElementById('nextBtn').style.display = 'block', 600);
    }

    function handleNext() {
        idx++;
        if(idx < cities.length) refreshRound();
        else { alert("MISSION COMPLETE! SCORE: " + score); location.reload(); }
    }

    // Á©∫ÁôΩÈçµÈÇÑÂéü
    window.onkeydown = e => {
        if(e.code === 'Space') {
            e.preventDefault();
            if(document.getElementById('confirmBtn').style.display === 'block') handleConfirm();
            else if(document.getElementById('nextBtn').style.display === 'block') handleNext();
        }
    };

    document.getElementById('startBtn').onclick = startMission;
    document.getElementById('confirmBtn').onclick = handleConfirm;
    document.getElementById('nextBtn').onclick = handleNext;
  </script>
</body>
</html>
